<script>
  // 1. Buat peta TANPA zoom default
  var map = L.map('map', {
    zoomControl: false
  }).setView([-0.13, 117.48], 13);

  // 2. Tambahkan zoom control di kanan atas
  L.control.zoom({
    position: 'topright'
  }).addTo(map);

  // 3. Basemap
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
  }).addTo(map);

  // 4. Variabel global
  var poiLayer;
  var poiData;

  // 5. Load GeoJSON
  fetch('sbsk_foto5.geojson')
    .then(response => response.json())
    .then(data => {
      poiData = data;
      poiLayer = L.layerGroup().addTo(map);
      updateMap();
    });

  // 6. Fungsi update filter
  function updateMap() {

    if (!poiLayer || !poiData) return;

    poiLayer.clearLayers();

    var nama_satker = document.getElementById("nama_satker").value;
    var jarakcbd_km = document.getElementById("jarakcbd_km").value;

    var geojsonLayer = L.geoJSON(poiData, {
      filter: function (feature) {

        if (nama_satker !== "all" &&
            feature.properties.nama_satker !== nama_satker)
          return false;

        if (jarakcbd_km !== "all" &&
            feature.properties.jarakcbd_km > Number(jarakcbd_km))
          return false;

        return true;
      },

      onEachFeature: function (feature, layer) {

        var p = feature.properties;

        var popupContent =
          "<b>" + p.nama_satker + "</b><br>" +
          "Kode Barang: " + p.kode_barang + "<br>" +
          "NUP: " + p.nup + "<br>" +
          "Jenis Barang: " + p.jenis_barang + "<br>" +
          "Luas: " + p.luas_m2 + " m²<br>" +
          "Jarak ke CBD: <b>" + p.jarakcbd_km + " km</b><br>" +
          "<img src='" + p.foto + "' width='250'>";

        layer.bindPopup(popupContent);
      }
    });

    geojsonLayer.addTo(poiLayer);

    // Zoom ke data jika ada
    if (poiLayer.getLayers().length > 0) {
      map.fitBounds(poiLayer.getBounds(), { padding: [30, 30] });
    }
  }
</script>
