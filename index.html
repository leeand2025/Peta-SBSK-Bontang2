<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Peta POI & Jarak ke CBD</title>

  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    body { margin: 0; padding: 0; }
    #map { height: 100vh; width: 100%; }

    #panel {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 10px;
      z-index: 1000;
      font-size: 13px;
    }
  </style>
</head>
<body>

<div id="panel">
  <label>Nama Satker</label><br>
  <select id="nama_satker" onchange="updateMap()">
    <option value="all">Semua</option>
    <option value="POLRES BONTANG">Polres Bontang</option>
    <option value="KPP Pratama Bontang">KPP Pratama Bontang</option>
  </select>

  <br><br>

  <label>Jarak ke CBD</label><br>
  <select id="jarakcbd_km" onchange="updateMap()">
    <option value="all">Semua</option>
    <option value="10">≤ 10 km</option>
    <option value="30">≤ 30 km</option>
  </select>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  // 1. Buat peta TANPA zoom default
  var map = L.map('map', {
    zoomControl: false
  }).setView([-0.13, 117.48], 13);

  // 2. Tambahkan zoom control di kanan atas
  L.control.zoom({
    position: 'topright'
  }).addTo(map);

  // 3. Basemap
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
  }).addTo(map);

  var poiLayer = L.layerGroup().addTo(map);
  var poiData = null;

  // 4. Load GeoJSON
  fetch('sbsk_foto5.geojson')
    .then(r => r.json())
    .then(data => {
      poiData = data;
      updateMap();
    });

  function updateMap() {

    if (!poiData) return;

    poiLayer.clearLayers();

    var nama_satker = document.getElementById("nama_satker").value;
    var jarakcbd_km = document.getElementById("jarakcbd_km").value;

    var geojsonLayer = L.geoJSON(poiData, {

      filter: function (feature) {

        if (nama_satker !== "all" &&
            feature.properties.nama_satker !== nama_satker)
          return false;

        if (jarakcbd_km !== "all" &&
            feature.properties.jarakcbd_km > Number(jarakcbd_km))
          return false;

        return true;
      },

      onEachFeature: function (feature, layer) {

        var p = feature.properties;

        var popupContent =
          "<b>" + p.nama_satker + "</b><br>" +
          "Kode Barang: " + p.kode_barang + "<br>" +
          "NUP: " + p.nup + "<br>" +
          "Jenis Barang: " + p.jenis_barang + "<br>" +
          "Luas: " + p.luas_m2 + " m²<br>" +
          "Jarak ke CBD: <b>" + p.jarakcbd_km + " km</b><br>" +
          "<img src='" + p.foto + "' width='250'>";

        layer.bindPopup(popupContent);
      }
    });

    geojsonLayer.addTo(poiLayer);

    if (poiLayer.getLayers().length > 0) {
      map.fitBounds(poiLayer.getBounds());
    }
  }
</script>

</body>
</html>
