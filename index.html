<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Peta POI & Jarak ke CBD</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    body { margin: 0; padding: 0; }
    #map { height: 100vh; width: 100%; }
  </style>
</head>
<body>

<div id="panel">
  <label>Nama Satker</label><br>
  <select id="nama_satker" onchange="updateMap()">
    <option value="all">Semua</option>
    <option value="POLRES BONTANG">Polres Bontang</option>
    <option value="KPP Pratama Bontang">KPP Pratama Bontang</option>
  </select>

  <br><br>

  <label>Jarak ke CBD</label><br>
  <select id="jarakcbd_km" onchange="updateMap()">
    <option value="all">Semua</option>
    <option value="10">≤ 10 km</option>
    <option value="30">≤ 30 km</option>
  </select>
</div>

<style>
#panel {
  position: absolute;
  top: 10px;
  left: 10px;
  background: white;
  padding: 10px;
  z-index: 1000;
  font-size: 13px;
}
</style>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  // 1. Buat peta
  var map = L.map('map').setView([-1.25, 117.50], 13); // ganti jika perlu

  // 2. Basemap
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
  }).addTo(map);

  // 3. Load GeoJSON POI
  var poiLayer;
  var poiData;

  fetch('sbsk_foto5.geojson')
    .then(response => response.json())
    .then(data => {
      poiData = data;
      poiLayer = L.layerGroup().addTo(map);
      updateMap();
    });

  function updateMap() {
    poiLayer.clearLayers();

    var nama_satker = document.getElementById("nama_satker").value;
    var jarakcbd_km = document.getElementById("jarakcbd_km").value;

    L.geoJSON(poiData, {
    filter: function (feature) {

      if (nama_satker !== "all" &&
          feature.properties.nama_satker !== nama_satker)
        return false;

      if (jarakcbd_km !== "all" &&
          feature.properties.jarakcbd_km > Number(jarakcbd_km))
        return false;

      return true;
    },

        onEachFeature: function (feature, layer) {

          var p = feature.properties;

          var popupContent =
            "<b>" + p.nama_satker + "</b><br>" +
            "Kode Barang: " + p.kode_barang + "<br>" +
            "NUP: " + p.nup + "<br>" +
            "Jenis Barang: " + p.jenis_barang + "<br>" +
            "Luas: " + p.luas_m2 + " m²<br>" +
            "Jarak ke CBD: <b>" + p.jarakcbd_km + " km</b>" +
            "<img src='" + p.foto + "' width='250'><br><br>";

          layer.bindPopup(popupContent);
        }
      }).addTo(map);

      // 4. Zoom ke seluruh POI
      map.fitBounds(poiLayer.getBounds());

    });
</script>

</body>
</html>
